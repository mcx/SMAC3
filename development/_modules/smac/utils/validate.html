
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>smac.utils.validate &#8212; SMAC3 Documentation 1.3.3 documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ac9c05f7c49ca1e1f876c6e36360ea26.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.9ea38e314b9e6d9dab77.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
  <a class="navbar-brand" href="../../../index.html">
    <img src="../../../_static/logo.png" class="logo" alt="logo">
  </a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/https://github.com/automl/SMAC3" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/automl_org?lang=de" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search align-items-center" action="../../../search.html" method="get"
style="width: 100%;">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><h4 class="mt-0 mb-0">SMAC3 Documentation</h4>
<div class="mb-3">v1.3.3</div><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../getting_started/index.html">
   Getting Started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../getting_started/installation.html">
     Installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../getting_started/minimal_example.html">
     Minimal Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../getting_started/package_overview.html">
     Package Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../getting_started/basic_usage.html">
     Basic Usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../examples/index.html">
   Examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/commandline/spear_qcp.html">
     SPEAR-QCP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/commandline/branin.html">
     Branin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/commandline/restore_branin.html">
     Restore Branin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/spear_mf_instances.html">
     SPEAR-QCP with Multi-Fidelity on Instances
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_simple_multi_objective.html">
     Simple Multi-Objective
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_synthetic_function.html">
     Synthetic Function with few Hyperparameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_svm_eips.html">
     SVM with EIPS as acquisition functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_gb_non_deterministic.html">
     Non-Deterministic Gradient-Boosting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_svm_cv.html">
     SVM with Cross-Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_sgd_instances.html">
     SGD on Instances
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_user_prior_mlp.html">
     HPO with User Priors over the Optimum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_mlp_mf.html">
     MLP with Multi-Fidelity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../examples/python/plot_scalarized_multi_objective.html">
     Scalarized Multi-Objective Using ParEGO
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../details/index.html">
   Details
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/facades.html">
     Facades
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/target_algorithm_evaluator.html">
     Target Algorithm Evaluator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/scenario.html">
     Scenario
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/arguments.html">
     Arguments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/multi_objective.html">
     Multi-Objective Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/run_history.html">
     Run-History
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/instances.html">
     Instances and Features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/validation.html">
     Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/callbacks.html">
     Callbacks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/parallelism.html">
     Parallelism
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/cuda.html">
     CUDA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../details/restoring.html">
     Restoring
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api.html">
   API References
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.epm.html">
     smac.epm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.facade.html">
     smac.facade
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.initial_design.html">
     smac.initial_design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.intensification.html">
     smac.intensification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.optimizer.html">
     smac.optimizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.runhistory.html">
     smac.runhistory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.scenario.html">
     smac.scenario
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.smac_cli.html">
     smac.smac_cli
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.stats.html">
     smac.stats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.tae.html">
     smac.tae
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.callbacks.html">
     smac.callbacks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../api/smac.utils.html">
     smac.utils
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../faq.html">
   F.A.Q.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../license.html">
   License
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for smac.utils.validate</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">from</span> <span class="nn">smac.configspace</span> <span class="kn">import</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">convert_configurations_to_array</span>
<span class="kn">from</span> <span class="nn">smac.epm.rf_with_instances</span> <span class="kn">import</span> <span class="n">RandomForestWithInstances</span>
<span class="kn">from</span> <span class="nn">smac.epm.rfr_imputator</span> <span class="kn">import</span> <span class="n">RFRImputator</span>
<span class="kn">from</span> <span class="nn">smac.epm.util_funcs</span> <span class="kn">import</span> <span class="n">get_types</span>
<span class="kn">from</span> <span class="nn">smac.runhistory.runhistory</span> <span class="kn">import</span> <span class="n">RunHistory</span><span class="p">,</span> <span class="n">RunInfo</span><span class="p">,</span> <span class="n">RunKey</span><span class="p">,</span> <span class="n">RunValue</span><span class="p">,</span> <span class="n">StatusType</span>
<span class="kn">from</span> <span class="nn">smac.runhistory.runhistory2epm</span> <span class="kn">import</span> <span class="n">RunHistory2EPM4Cost</span>
<span class="kn">from</span> <span class="nn">smac.scenario.scenario</span> <span class="kn">import</span> <span class="n">Scenario</span>
<span class="kn">from</span> <span class="nn">smac.stats.stats</span> <span class="kn">import</span> <span class="n">Stats</span>
<span class="kn">from</span> <span class="nn">smac.tae.base</span> <span class="kn">import</span> <span class="n">BaseRunner</span>
<span class="kn">from</span> <span class="nn">smac.tae.execute_ta_run_old</span> <span class="kn">import</span> <span class="n">ExecuteTARunOld</span>
<span class="kn">from</span> <span class="nn">smac.utils.constants</span> <span class="kn">import</span> <span class="n">MAXINT</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Joshua Marben&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2017, ML4AAD&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;3-clause BSD&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Joshua Marben&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;joshua.marben@neptun.uni-freiburg.de&quot;</span>


<span class="k">def</span> <span class="nf">_unbound_tae_starter</span><span class="p">(</span>
    <span class="n">tae</span><span class="p">:</span> <span class="n">BaseRunner</span><span class="p">,</span>
    <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">],</span>
    <span class="n">run_info</span><span class="p">:</span> <span class="n">RunInfo</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunValue</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Unbound function to be used by joblibs Parallel, since directly passing the TAE results in</span>
<span class="sd">    pickling-problems.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tae: BaseRunner</span>
<span class="sd">        tae to be used</span>
<span class="sd">    runhistory: RunHistory</span>
<span class="sd">        runhistory to save</span>
<span class="sd">    run_info: RunInfo</span>
<span class="sd">        Config to be launched</span>
<span class="sd">    *args, **kwargs: various</span>
<span class="sd">        arguments to the tae</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tae_results: RunValue</span>
<span class="sd">        return from tae.start</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_info</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">tae</span><span class="o">.</span><span class="n">run_wrapper</span><span class="p">(</span><span class="n">run_info</span><span class="p">)</span>
    <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">submitted_ta_runs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">finished_ta_runs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ta_time_used</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">runhistory</span><span class="p">:</span>
        <span class="n">runhistory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">cost</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
            <span class="n">instance_id</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
            <span class="n">budget</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">budget</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">n_configs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">runhistory</span><span class="o">.</span><span class="n">config_ids</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="n">_Run</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;_Run&quot;</span><span class="p">,</span> <span class="s2">&quot;config inst seed inst_specs&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Validator"><a class="viewcode-back" href="../../../api/smac.utils.validate.html#smac.utils.validate.Validator">[docs]</a><span class="k">class</span> <span class="nc">Validator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator for the output of SMAC-scenarios.</span>

<span class="sd">    Evaluates specified configurations on specified instances.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scenario: Scenario</span>
<span class="sd">        scenario object for cutoff, instances, features and specifics</span>
<span class="sd">    trajectory: trajectory-list</span>
<span class="sd">        trajectory to take incumbent(s) from</span>
<span class="sd">    rng: np.random.RandomState or int</span>
<span class="sd">        Random number generator or seed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scenario</span><span class="p">:</span> <span class="n">Scenario</span><span class="p">,</span>
        <span class="n">trajectory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">],</span>
        <span class="n">rng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">traj</span> <span class="o">=</span> <span class="n">trajectory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scen</span> <span class="o">=</span> <span class="n">scenario</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: typing.Optional[RandomForestWithInstances]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">rng</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;no seed given, using default seed of 1&quot;</span><span class="p">)</span>
            <span class="n">num_run</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">num_run</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rh</span><span class="p">:</span> <span class="n">RunHistory</span><span class="p">,</span>
        <span class="n">output_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">backup_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Helper to save results to file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rh: RunHistory</span>
<span class="sd">            runhistory to save</span>
<span class="sd">        output_fn: str</span>
<span class="sd">            if ends on &#39;.json&#39;: filename to save history to</span>
<span class="sd">            else: directory to save runhistory to (filename is backup_fn)</span>
<span class="sd">        backup_fn: str</span>
<span class="sd">            if output_fn does not end on &#39;.json&#39;, treat output_fn as dir and</span>
<span class="sd">            append backup_fn as filename (if output_fn ends on &#39;.json&#39;, this</span>
<span class="sd">            argument is ignored)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_fn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No output specified, validated runhistory not saved.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Check if a folder or a file is specified as output</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">backup_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If output_fn does not end with .json the argument backup_fn needs to be given.&quot;</span><span class="p">)</span>
            <span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_fn</span>
            <span class="n">output_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">backup_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Output is &quot;</span><span class="si">%s</span><span class="s1">&quot;, changing to &quot;</span><span class="si">%s</span><span class="s1">&quot;!&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">output_fn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Folder (&quot;</span><span class="si">%s</span><span class="s1">&quot;) doesn</span><span class="se">\&#39;</span><span class="s1">t exist, creating.&#39;</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">rh</span><span class="o">.</span><span class="n">save_json</span><span class="p">(</span><span class="n">output_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving validation-results in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">)</span>

<div class="viewcode-block" id="Validator.validate"><a class="viewcode-back" href="../../../api/smac.utils.validate.html#smac.utils.validate.Validator.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;def&quot;</span><span class="p">,</span>
        <span class="n">instance_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;threading&quot;</span><span class="p">,</span>
        <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tae</span><span class="p">:</span> <span class="n">BaseRunner</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunHistory</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Validate configs on instances and save result in runhistory. If a runhistory is provided</span>
<span class="sd">        as input it is important that you run it on the same/comparable hardware.</span>

<span class="sd">        side effect: if output is specified, saves runhistory to specified</span>
<span class="sd">        output directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config_mode: str or list&lt;Configuration&gt;</span>
<span class="sd">            string or directly a list of Configuration.</span>
<span class="sd">            string from [def, inc, def+inc, wallclock_time, cpu_time, all].</span>
<span class="sd">            time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">            [max_time/2^0, max_time/2^1, max_time/2^3, ..., default]</span>
<span class="sd">            with max_time being the highest recorded time</span>
<span class="sd">        instance_mode: str or list&lt;str&gt;</span>
<span class="sd">            what instances to use for validation, either from</span>
<span class="sd">            [train, test, train+test] or directly a list of instances</span>
<span class="sd">        repetitions: int</span>
<span class="sd">            number of repetitions in nondeterministic algorithms</span>
<span class="sd">        n_jobs: int</span>
<span class="sd">            number of parallel processes used by joblib</span>
<span class="sd">        backend: str</span>
<span class="sd">            what backend joblib should use for parallel runs</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, RunHistory-object to reuse runs</span>
<span class="sd">        tae: BaseRunner</span>
<span class="sd">            tae to be used. if None, will initialize ExecuteTARunOld</span>
<span class="sd">        output_fn: str</span>
<span class="sd">            path to runhistory to be saved. if the suffix is not &#39;.json&#39;, will</span>
<span class="sd">            be interpreted as directory and filename will be</span>
<span class="sd">            &#39;validated_runhistory.json&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            runhistory with validated runs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Validating configs &#39;</span><span class="si">%s</span><span class="s2">&#39; on instances &#39;</span><span class="si">%s</span><span class="s2">&#39;, repeating </span><span class="si">%d</span><span class="s2"> times&quot;</span> <span class="s2">&quot; with </span><span class="si">%d</span><span class="s2"> parallel runs on backend &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="n">config_mode</span><span class="p">,</span>
            <span class="n">instance_mode</span><span class="p">,</span>
            <span class="n">repetitions</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="p">,</span>
            <span class="n">backend</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get all runs to be evaluated as list</span>
        <span class="n">runs</span><span class="p">,</span> <span class="n">validated_rh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_runs</span><span class="p">(</span><span class="n">config_mode</span><span class="p">,</span> <span class="n">instance_mode</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>

        <span class="c1"># Create new Stats without limits</span>
        <span class="n">inf_scen</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;run_obj&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">run_obj</span><span class="p">,</span>
                <span class="s2">&quot;cutoff_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="s2">&quot;output_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">inf_stats</span> <span class="o">=</span> <span class="n">Stats</span><span class="p">(</span><span class="n">inf_scen</span><span class="p">)</span>
        <span class="n">inf_stats</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="c1"># Create TAE</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tae</span><span class="p">:</span>
            <span class="n">tae</span> <span class="o">=</span> <span class="n">ExecuteTARunOld</span><span class="p">(</span>
                <span class="n">ta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">ta</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="n">stats</span><span class="o">=</span><span class="n">inf_stats</span><span class="p">,</span>
                <span class="n">run_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">run_obj</span><span class="p">,</span>
                <span class="n">par_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">par_factor</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="n">cost_for_crash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cost_for_crash</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Inject endless-stats</span>
            <span class="n">tae</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">inf_stats</span>

        <span class="c1"># Validate!</span>
        <span class="n">run_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_parallel</span><span class="p">(</span><span class="n">tae</span><span class="p">,</span> <span class="n">runs</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="p">(</span><span class="n">run_results</span><span class="p">,</span> <span class="n">runs</span><span class="p">)</span>

        <span class="c1"># tae returns (status, cost, runtime, additional_info)</span>
        <span class="c1"># Add runs to RunHistory</span>
        <span class="k">for</span> <span class="n">run</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">run_results</span><span class="p">):</span>
            <span class="n">validated_rh</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                <span class="n">cost</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                <span class="n">instance_id</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
                <span class="n">additional_info</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">additional_info</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_save_results</span><span class="p">(</span><span class="n">validated_rh</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">,</span> <span class="n">backup_fn</span><span class="o">=</span><span class="s2">&quot;validated_runhistory.json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validated_rh</span></div>

    <span class="k">def</span> <span class="nf">_validate_parallel</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tae</span><span class="p">:</span> <span class="n">BaseRunner</span><span class="p">,</span>
        <span class="n">runs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_Run</span><span class="p">],</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">RunValue</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Validate runs with joblibs Parallel-interface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tae: BaseRunner</span>
<span class="sd">            tae to be used for validation</span>
<span class="sd">        runs: list&lt;_Run&gt;</span>
<span class="sd">            list with _Run-objects</span>
<span class="sd">            [_Run(config=CONFIG1,inst=INSTANCE1,seed=SEED1,inst_specs=INST_SPECIFICS1), ...]</span>
<span class="sd">        n_jobs: int</span>
<span class="sd">            number of cpus to use for validation (-1 to use all)</span>
<span class="sd">        backend: str</span>
<span class="sd">            what backend to use for parallelization</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, RunHistory-object to reuse runs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        run_results: list&lt;tuple(tae-returns)&gt;</span>
<span class="sd">            results as returned by tae</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Runs with parallel</span>
        <span class="n">run_results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)(</span>
            <span class="n">delayed</span><span class="p">(</span><span class="n">_unbound_tae_starter</span><span class="p">)(</span>
                <span class="n">tae</span><span class="p">,</span>
                <span class="n">runhistory</span><span class="p">,</span>
                <span class="n">RunInfo</span><span class="p">(</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">instance</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span>
                    <span class="n">instance_specific</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
                    <span class="n">cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                    <span class="n">capped</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">budget</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">run_results</span>

<div class="viewcode-block" id="Validator.validate_epm"><a class="viewcode-back" href="../../../api/smac.utils.validate.html#smac.utils.validate.Validator.validate_epm">[docs]</a>    <span class="k">def</span> <span class="nf">validate_epm</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;def&quot;</span><span class="p">,</span>
        <span class="n">instance_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reuse_epm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunHistory</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Use EPM to predict costs/runtimes for unknown config/inst-pairs.</span>

<span class="sd">        side effect: if output is specified, saves runhistory to specified</span>
<span class="sd">        output directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_fn: str</span>
<span class="sd">            path to runhistory to be saved. if the suffix is not &#39;.json&#39;, will</span>
<span class="sd">            be interpreted as directory and filename will be</span>
<span class="sd">            &#39;validated_runhistory_EPM.json&#39;</span>
<span class="sd">        config_mode: str or list&lt;Configuration&gt;</span>
<span class="sd">            string or directly a list of Configuration, string from [def, inc, def+inc, wallclock_time, cpu_time, all].</span>
<span class="sd">            time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">            [max_time/2^0, max_time/2^1, max_time/2^3, ..., default] with max_time being the highest recorded time</span>
<span class="sd">        instance_mode: str or list&lt;str&gt;</span>
<span class="sd">            what instances to use for validation, either from</span>
<span class="sd">            [train, test, train+test] or directly a list of instances</span>
<span class="sd">        repetitions: int</span>
<span class="sd">            number of repetitions in nondeterministic algorithms</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, RunHistory-object to reuse runs</span>
<span class="sd">        reuse_epm: bool</span>
<span class="sd">            if true (and if `self.epm`), reuse epm to validate runs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            runhistory with predicted runs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">runhistory</span><span class="p">,</span> <span class="n">RunHistory</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">reuse_epm</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No runhistory specified for validating with EPM!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">reuse_epm</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Create RandomForest</span>
            <span class="n">types</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
            <span class="n">epm</span> <span class="o">=</span> <span class="n">RandomForestWithInstances</span><span class="p">(</span>
                <span class="n">configspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">instance_features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">MAXINT</span><span class="p">),</span>
                <span class="n">ratio_features</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Use imputor if objective is runtime</span>
            <span class="n">imputor</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">impute_state</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">impute_censored_data</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">run_obj</span> <span class="o">==</span> <span class="s2">&quot;runtime&quot;</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">par_factor</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="n">imputor</span> <span class="o">=</span> <span class="n">RFRImputator</span><span class="p">(</span>
                    <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span>
                    <span class="n">cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                    <span class="n">model</span><span class="o">=</span><span class="n">epm</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">impute_censored_data</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">impute_state</span> <span class="o">=</span> <span class="p">[</span><span class="n">StatusType</span><span class="o">.</span><span class="n">CAPPED</span><span class="p">]</span>
                <span class="n">success_states</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">StatusType</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">StatusType</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">CRASHED</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">MEMOUT</span><span class="p">]</span>

            <span class="c1"># Transform training data (from given rh)</span>
            <span class="n">rh2epm</span> <span class="o">=</span> <span class="n">RunHistory2EPM4Cost</span><span class="p">(</span>
                <span class="n">num_params</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">()),</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="p">,</span>
                <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span>
                <span class="n">impute_censored_data</span><span class="o">=</span><span class="n">impute_censored_data</span><span class="p">,</span>
                <span class="n">imputor</span><span class="o">=</span><span class="n">imputor</span><span class="p">,</span>
                <span class="n">impute_state</span><span class="o">=</span><span class="n">impute_state</span><span class="p">,</span>
                <span class="n">success_states</span><span class="o">=</span><span class="n">success_states</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">runhistory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># please mypy</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">rh2epm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">runhistory</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Training model with data of shape X: </span><span class="si">%s</span><span class="s2">, y:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="c1"># Train random forest</span>
            <span class="n">epm</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">epm</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">RandomForestWithInstances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epm</span><span class="p">)</span>

        <span class="c1"># Predict desired runs</span>
        <span class="n">runs</span><span class="p">,</span> <span class="n">rh_epm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_runs</span><span class="p">(</span><span class="n">config_mode</span><span class="p">,</span> <span class="n">instance_mode</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>

        <span class="n">feature_array_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">())</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">feature_array_size</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">X_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="n">feature_array_size</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">run</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">X_pred</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">convert_configurations_to_array</span><span class="p">([</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_dict</span><span class="p">[</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">X_pred</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_configurations_to_array</span><span class="p">([</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Predicting desired </span><span class="si">%d</span><span class="s2"> runs, data has shape </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">X_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">epm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="o">=</span> <span class="n">epm</span>

        <span class="c1"># Add runs to runhistory</span>
        <span class="k">for</span> <span class="n">run</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">rh_epm</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                <span class="n">cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span>
                <span class="n">time</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span>
                <span class="n">status</span><span class="o">=</span><span class="n">StatusType</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span>
                <span class="n">instance_id</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">additional_info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;additional_info&quot;</span><span class="p">:</span> <span class="s2">&quot;ESTIMATED USING EPM!&quot;</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">output_fn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_results</span><span class="p">(</span><span class="n">rh_epm</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">,</span> <span class="n">backup_fn</span><span class="o">=</span><span class="s2">&quot;validated_runhistory_EPM.json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rh_epm</span></div>

    <span class="k">def</span> <span class="nf">_get_runs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]],</span>
        <span class="n">insts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">runhistory</span><span class="p">:</span> <span class="n">RunHistory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_Run</span><span class="p">],</span> <span class="n">RunHistory</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Generate list of SMAC-TAE runs to be executed. This means combinations of configs with</span>
<span class="sd">        all instances on a certain number of seeds.</span>

<span class="sd">        side effect: Adds runs that don&#39;t need to be reevaluated to self.rh!</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        configs: str or list&lt;Configuration&gt;</span>
<span class="sd">            string or directly a list of Configuration</span>
<span class="sd">            str from [def, inc, def+inc, wallclock_time, cpu_time, all]</span>
<span class="sd">            time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">            [max_time/2^0, max_time/2^1, max_time/2^3, ..., default]</span>
<span class="sd">            with max_time being the highest recorded time</span>
<span class="sd">        insts: str or list&lt;str&gt;</span>
<span class="sd">            what instances to use for validation, either from</span>
<span class="sd">            [train, test, train+test] or directly a list of instances</span>
<span class="sd">        repetitions: int</span>
<span class="sd">            number of seeds per instance/config-pair to be evaluated</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, try to reuse this runhistory and save some runs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        runs: list&lt;_Run&gt;</span>
<span class="sd">            list with _Runs</span>
<span class="sd">            [_Run(config=CONFIG1,inst=INSTANCE1,seed=SEED1,inst_specs=INST_SPECIFICS1),</span>
<span class="sd">             _Run(config=CONFIG2,inst=INSTANCE2,seed=SEED2,inst_specs=INST_SPECIFICS2),</span>
<span class="sd">             ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get relevant configurations and instances</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">insts</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_instances</span><span class="p">(</span><span class="n">insts</span><span class="p">))</span>  <span class="c1"># type: typing.Sequence[typing.Union[str, None]]</span>
        <span class="k">elif</span> <span class="n">insts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">insts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1"># If no instances are given, fix the instances to one &quot;None&quot; instance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="c1"># If algorithm is deterministic, fix repetitions to 1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">deterministic</span> <span class="ow">and</span> <span class="n">repetitions</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Specified </span><span class="si">%d</span><span class="s2"> repetitions, but fixing to 1, &quot;</span> <span class="s2">&quot;because algorithm is deterministic.&quot;</span><span class="p">,</span>
                <span class="n">repetitions</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">repetitions</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Extract relevant information from given runhistory</span>
        <span class="n">inst_seed_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_runhistory</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="n">instances</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>

        <span class="c1"># Now create the actual run-list</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Counter for runs without the need of recalculation</span>
        <span class="n">runs_from_rh</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># If we reuse runs, we want to return them as well</span>
        <span class="n">new_rh</span> <span class="o">=</span> <span class="n">RunHistory</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
                <span class="c1"># First, find a seed and add all the data we can take from the</span>
                <span class="c1"># given runhistory to &quot;our&quot; validation runhistory.</span>
                <span class="n">configs_evaluated</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: Configuration</span>
                <span class="k">if</span> <span class="n">runhistory</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">:</span>
                    <span class="c1"># Choose seed based on most often evaluated inst-seed-pair</span>
                    <span class="n">seed</span><span class="p">,</span> <span class="n">configs_evaluated</span> <span class="o">=</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># Delete inst if all seeds are used</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">inst_seed_config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1"># Add runs to runhistory</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">configs_evaluated</span><span class="p">[:]:</span>
                        <span class="n">runkey</span> <span class="o">=</span> <span class="n">RunKey</span><span class="p">(</span><span class="n">runhistory</span><span class="o">.</span><span class="n">config_ids</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
                        <span class="n">cost</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">additional_info</span> <span class="o">=</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">runkey</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">StatusType</span><span class="o">.</span><span class="n">CRASHED</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">ABORT</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">CAPPED</span><span class="p">]:</span>
                            <span class="c1"># Not properly executed target algorithm runs should be repeated</span>
                            <span class="n">configs_evaluated</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="n">new_rh</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                            <span class="n">c</span><span class="p">,</span>
                            <span class="n">cost</span><span class="p">,</span>
                            <span class="n">time</span><span class="p">,</span>
                            <span class="n">status</span><span class="p">,</span>
                            <span class="n">instance_id</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                            <span class="n">starttime</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                            <span class="n">endtime</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                            <span class="n">additional_info</span><span class="o">=</span><span class="n">additional_info</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">runs_from_rh</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If no runhistory or no entries for instance, get new seed</span>
                    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">MAXINT</span><span class="p">)</span>

                <span class="c1"># We now have a seed and add all configs that are not already</span>
                <span class="c1"># evaluated on that seed to the runs-list. This way, we</span>
                <span class="c1"># guarantee the same inst-seed-pairs for all configs.</span>
                <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">configs</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configs_evaluated</span><span class="p">]:</span>
                    <span class="c1"># Only use specifics if specific exists, else use string &quot;0&quot;</span>
                    <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">instance_specific</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">instance_specific</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
                    <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_Run</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">inst</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">inst_specs</span><span class="o">=</span><span class="n">specs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Collected </span><span class="si">%d</span><span class="s2"> runs from </span><span class="si">%d</span><span class="s2"> configurations on </span><span class="si">%d</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;instances with </span><span class="si">%d</span><span class="s2"> repetitions. Reusing </span><span class="si">%d</span><span class="s2"> runs from &quot;</span>
            <span class="s2">&quot;given runhistory.&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">),</span>
            <span class="n">repetitions</span><span class="p">,</span>
            <span class="n">runs_from_rh</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">runs</span><span class="p">,</span> <span class="n">new_rh</span>

    <span class="k">def</span> <span class="nf">_process_runhistory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">],</span>
        <span class="n">insts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]]]]:</span>
        <span class="sd">&quot;&quot;&quot;Processes runhistory from self._get_runs by extracting already evaluated (relevant)</span>
<span class="sd">        config-inst-seed tuples.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        configs: list(Configuration)</span>
<span class="sd">            list of configs of interest</span>
<span class="sd">        insts: list(str)</span>
<span class="sd">            list of instances of interest</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            runhistory to extract runs from</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        inst_seed_config: dict&lt;str : list(tuple(int, tuple(configs)))&gt;</span>
<span class="sd">            dictionary mapping instances to a list of tuples of already used</span>
<span class="sd">            seeds and the configs that this inst-seed-pair has been evaluated</span>
<span class="sd">            on, sorted by the number of configs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We want to reuse seeds that have been used on most configurations</span>
        <span class="c1"># To this end, we create a dictionary as {instances:{seed:[configs]}}</span>
        <span class="c1"># Like this we can easily retrieve the most used instance-seed pairs to</span>
        <span class="c1"># minimize the number of runs to be evaluated</span>
        <span class="k">if</span> <span class="n">runhistory</span><span class="p">:</span>
            <span class="n">inst_seed_config</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: typing.Dict[str, typing.Dict[int, typing.List[Configuration]]]</span>
            <span class="n">relevant</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">ids_config</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">config_id</span><span class="p">]</span> <span class="ow">in</span> <span class="n">configs</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">instance_id</span> <span class="ow">in</span> <span class="n">insts</span><span class="p">:</span>
                    <span class="n">relevant</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="c1"># Change data-structure to {instances:[(seed1, (configs)), (seed2, (configs), ... ]}</span>
            <span class="c1"># to make most used seed easily accessible, we sort after length of configs</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
                <span class="n">inst</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">instance_id</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">seed</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">ids_config</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">config_id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">]:</span>
                        <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">config</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">seed</span><span class="p">:</span> <span class="p">[</span><span class="n">config</span><span class="p">]}</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="n">i</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">seed</span><span class="p">]))</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inst_seed_config</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rval</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: typing.Dict[str, typing.List[typing.Tuple[int, typing.List[Configuration]]]]</span>
            <span class="k">return</span> <span class="n">rval</span>

    <span class="k">def</span> <span class="nf">_get_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return desired configs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode: str</span>
<span class="sd">            str from [def, inc, def+inc, wallclock_time, cpu_time, all]</span>
<span class="sd">                time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">                [max_time/2^0, max_time/2^1, max_time/2^3, ..., default]</span>
<span class="sd">                with max_time being the highest recorded time</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs: list&lt;Configuration&gt;</span>
<span class="sd">            list with desired configurations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get trajectory and make sure it&#39;s not None to please mypy</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traj</span>
        <span class="k">assert</span> <span class="n">traj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># please mypy</span>

        <span class="c1"># Add desired configs</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;def&quot;</span><span class="p">,</span> <span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="s2">&quot;def+inc&quot;</span><span class="p">,</span> <span class="s2">&quot;wallclock_time&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu_time&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not a valid option for config_mode in validation.&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;def&quot;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;def+inc&quot;</span><span class="p">:</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">get_default_configuration</span><span class="p">())</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;inc&quot;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;def+inc&quot;</span><span class="p">:</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;wallclock_time&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu_time&quot;</span><span class="p">]:</span>
            <span class="c1"># get highest time-entry and add entries from there</span>
            <span class="c1"># not using wallclock_limit in case it&#39;s inf</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;wallclock_time&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">wallclock_limit</span><span class="p">):</span>
                <span class="n">max_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">wallclock_limit</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;cpu_time&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">algo_runs_timelimit</span><span class="p">):</span>
                <span class="n">max_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">algo_runs_timelimit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_time</span> <span class="o">=</span> <span class="n">traj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">mode</span><span class="p">]</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_time</span> <span class="o">/</span> <span class="n">counter</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
                    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>
                    <span class="n">counter</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">traj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;incumbent&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
                <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>  <span class="c1"># add first</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
                    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Gathered </span><span class="si">%d</span><span class="s2"> configurations for mode </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">),</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">configs</span>

    <span class="k">def</span> <span class="nf">_get_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get desired instances.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode: str</span>
<span class="sd">            what instances to use for validation, from [train, test, train+test]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        instances: list&lt;str&gt;</span>
<span class="sd">            instances to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;train+test&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not a valid option for instance_mode in validation.&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

        <span class="c1"># Make sure if instances matter, than instances should be passed</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">instance_mode</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">train_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">instance_mode</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">test_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Instance mode is set to </span><span class="si">%s</span><span class="s2">, but there are no &quot;</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-instances specified in the scenario. Setting instance mode to&quot;</span>
                <span class="s1">&#39;&quot;train+test&quot;!&#39;</span><span class="p">,</span>
                <span class="n">instance_mode</span><span class="p">,</span>
                <span class="n">instance_mode</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">instance_mode</span> <span class="o">=</span> <span class="s2">&quot;train+test&quot;</span>

        <span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: typing.List[str]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">instance_mode</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span> <span class="ow">or</span> <span class="n">instance_mode</span> <span class="o">==</span> <span class="s2">&quot;train+test&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">train_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">train_insts</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">instance_mode</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span> <span class="ow">or</span> <span class="n">instance_mode</span> <span class="o">==</span> <span class="s2">&quot;train+test&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">test_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">test_insts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instances</span></div>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../_static/js/index.9ea38e314b9e6d9dab77.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 
    Copyright 2022, Marius Lindauer, Katharina Eggensperger,
    Matthias Feurer, André Biedenkapp, Difan Deng, Carolin Benjamins, Tim Ruhkopf, René Sass
    and Frank Hutter
.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a>
4.5.0. Template is modified version of <a
href="https://pydata-sphinx-theme.readthedocs.io">PyData Sphinx Theme</a>. <br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>